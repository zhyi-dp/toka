// Copyright (c) 2025 YiZhonghua<zhyi@dpai.com>. All rights reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

// include/toka/DiagnosticDefs.def

// --- Sema: Scope & Identifiers ---
DIAG(ERR_VAR_REDECLARED,     Error, "Variable '{}' is already declared in this scope")
DIAG(ERR_UNDECLARED,         Error, "Use of undeclared identifier '{}'")
DIAG(ERR_MODULE_NOT_FOUND,   Error, "Module '{}' not found")
DIAG(ERR_SYMBOL_NOT_FOUND,   Error, "Symbol '{}' not found in module '{}'")
DIAG(ERR_PRIVATE_TYPE,       Error, "Shape '{}' is private and cannot be accessed from module '{}'")

DIAG(ERR_GENERIC_SEMA,       Error, "{}")
DIAG(ERR_OPERAND_TYPE_MISMATCH, Error, "Operand of '{}' must be {}, got '{}'")
DIAG(NOTE_GENERIC,           Note, "{}")

// --- Sema: Type Checking & Operations ---
DIAG(ERR_TYPE_MISMATCH,      Error, "Cannot convert type '{}' to '{}'")
DIAG(ERR_INIT_TYPE_MISMATCH, Error, "Cannot initialize variable of type '{}' with value of type '{}'")
DIAG(ERR_USE_UNSET,          Error, "Use of unset variable or member '{}'")
DIAG(ERR_ESCAPE_UNSET,       Error, "Cannot escape an unset or dirty variable '{}'")
DIAG(ERR_DIRTY_REF_ESCAPE,   Error, "Reference '{}' to unset variable '{}' escapes scope without initialization")
DIAG(ERR_INVALID_OP,         Error, "Invalid operands for operation '{}': '{}' and '{}'")
DIAG(ERR_TYPE_REQUIRED,      Error, "Type annotation required for variable '{}'")
DIAG(ERR_INFER_NULLPTR,      Error, "Cannot infer type from 'nullptr'; explicit type annotation required (e.g., 'auto *p: Type = ...')")

// --- Sema: Shape & Structs ---
DIAG(ERR_UNKNOWN_STRUCT,     Error, "Unknown shape type '{}'")
DIAG(ERR_NO_SUCH_MEMBER,     Error, "Shape '{}' has no member named '{}'")
DIAG(ERR_MEMBER_PRIVATE,     Error, "Member '{}' of shape '{}' is private")
DIAG(ERR_MEMBER_NOT_FOUND,   Error, "Member '{}' not found on type '{}'")
DIAG(ERR_TUPLE_INDEX_OOB,    Error, "Tuple index '{}' out of range (size {})")
DIAG(ERR_NOT_A_STRUCT,       Error, "Member access '{}' on non-shape type '{}'")
DIAG(ERR_MEMBER_TYPE_MISMATCH, Error, "Type mismatch for member '{}': expected '{}', but got '{}'")
DIAG(ERR_MISSING_MEMBER,     Error, "Missing initialization for member '{}' of shape '{}'")
DIAG(ERR_DUPLICATE_FIELD,    Error, "Duplicate field '{}' in shape initialization")
DIAG(ERR_UNION_PARTIAL_INIT, Error, "Partial initialization of Union '{}': variant '{}' size {} is smaller than Union size {}")
DIAG(ERR_UNION_INVALID_MEMBER, Error, "Union member '{}' has restricted type '{}' (underlying '{}')")
DIAG(ERR_UNION_RESOURCE_TYPE, Error, "Union member '{}' has type '{}' which manages resources (HasDrop); unions must be data-only")
DIAG(NOTE_UNION_RESOURCE_TIP, Note, "Unions cannot track active variants to drop resources safely; consider using a raw pointer '*{}' or 'ManuallyDrop<T>'")

// --- Sema: Traits & Interfaces ---
DIAG(ERR_SIGNATURE_MISMATCH, Error, "Method signature mismatch: trait defines '{}' as {}, but implementation is {}")
DIAG(ERR_MISSING_IMPL,       Error, "Trait '{}' requires implementation of method '{}'")
DIAG(ERR_TRAIT_NOT_FOUND,    Error, "Trait '{}' is not implemented for type '{}'")

// --- Sema: Control Flow & Functions ---
DIAG(ERR_CONTROL_REACHES_END, Error, "Control flow reaches end of non-void function '{}'")
DIAG(ERR_YIELD_VALUE_REQUIRED, Error, "Yielding {} must pass a value")
DIAG(ERR_YIELD_ELSE_REQUIRED,  Error, "Yielding if expression must have an 'else' block")
DIAG(ERR_YIELD_OR_REQUIRED,    Error, "Yielding {} loop must have an 'or' block")
DIAG(ERR_BRANCH_TYPE_MISMATCH, Error, "{} branches have incompatible types: '{}' vs '{}'")
DIAG(ERR_PASS_NO_RECEIVER,    Error, "'pass' used without a receiver; prefix the expression with 'auto x =' or 'alias y ='")
DIAG(ERR_METHOD_PRIVATE,      Error, "Method '{}' is private to '{}' and cannot be accessed from module '{}'")

// --- Sema: Ownership & Resources (Toka Specials) ---
DIAG(ERR_USE_MOVED,          Error, "Use of moved value: '{}'")
DIAG(ERR_MOVE_MEMBER_DROP,   Error, "Cannot move member '{}' out of shape '{}' because it implements 'drop'")
DIAG(ERR_MOVE_BORROWED,      Error, "Cannot move '{}' while it is borrowed")
DIAG(ERR_BORROW_MUT,         Error, "Cannot access '{}' while it is mutably borrowed")
DIAG(ERR_BORROW_IMMUT,       Error, "Cannot mutably borrow immutable entity '{}'")
DIAG(ERR_IMMUTABLE_MOD,      Error, "Cannot modify immutable entity '{}'")
DIAG(ERR_SHAPE_NO_DROP,      Error, "Shape '{}' manages resources but does not implement 'drop'")
DIAG(ERR_UNSAFE_RAW_PTR,     Error, "Shape '{}' manages raw pointers but does not implement 'drop'")
DIAG(ERR_UNSAFE_RESOURCE,    Error, "Shape '{}' contains managed resources but does not implement 'drop'")
DIAG(ERR_NULL_ACCESS,        Error, "Accessing member of nullable type '{}' requires explicit 'is' check")
DIAG(ERR_MORPHOLOGY_MISMATCH, Error, "Pointer morphology mismatch: expected explicit '{}' (from LHS/Target), found '{}' (from RHS/Source)")
DIAG(ERR_SMART_PTR_FROM_STACK, Error, "Smart pointer sigil '{}' cannot be applied to stack variable; use 'new' or assign from existing smart pointer")
DIAG(ERR_CAST_MISMATCH,       Error, "Invalid cast: cannot convert '{}' to '{}' via 'as'; only 'Addr' and '*' conversions are supported")
DIAG(ERR_POINTER_SIGIL_MISSING, Error, "Variable '{}' implies pointer type '{}' but lacks explicit sigil. Use 'auto {}{}' or dereference.")
DIAG(ERR_MEMBER_SIGIL_MISMATCH, Error, "Dot operator '.' cannot be used with explicit pointer sigil. Did you mean '^ptr->member' or 'ptr.member'?")
DIAG(ERR_ARROW_SIGIL_REQUIRED,  Error, "Arrow operator '->' requires explicit pointer sigil on variable. Did you mean '^ptr->member'?")
DIAG(ERR_LIFETIME_UNION_REQUIRED, Error, "Returning reference to parameter '{}' requires explicit dependency declaration (<- {})")
DIAG(ERR_ESCAPE_LOCAL,           Error, "Returning reference to local variable '{}' is unsafe")
DIAG(ERR_BORROW_LIFETIME,        Error, "Object '{}' (lived longer) cannot depend on '{}' (lived shorter)")
DIAG(ERR_LIFETIME_UNION_VIOLATION, Error, "Lifetime union violation: '{}' does not live long enough")

// --- Sema: Memory Safety ---
DIAG(ERR_UNSAFE_ALLOC_CTX,   Error, "Operation 'alloc' is only allowed in unsafe context")
DIAG(ERR_FREE_SMART,         Error, "Manual 'free' forbidden for smart pointer '{}'; memory is managed automatically")
DIAG(ERR_FREE_NON_PTR,       Error, "Cannot 'free' value of type '{}'; expected raw pointer")

// --- Pattern Matching ---
DIAG(ERR_VARIANT_NO_PAYLOAD, Error, "Enum variant '{}' does not accept arguments")
DIAG(ERR_VARIANT_ARG_MISMATCH, Error, "Enum variant '{}' expects {} fields, but got {}")
DIAG(ERR_UNKNOWN_SHAPE_IN_PAT, Error, "Unknown type '{}' in pattern matching")

// --- Generics (Upcoming) ---
DIAG(ERR_GENERIC_COUNT_MISMATCH, Error, "Type '{}' expects {} generic arguments, but got {}")
DIAG(ERR_GENERIC_ARITY_MISMATCH, Error, "Generic mismatch for '{}': expected {} arguments, got {}")
DIAG(ERR_GENERIC_RECURSION_LIMIT, Error, "Generic instantiation recursion limit reached for '{}'")
DIAG(ERR_GENERIC_CODEGEN,    Error, "Generic instantiation failed: {}")
DIAG(ERR_CODEGEN,            Error, "Code generation failed: {}")
DIAG(ERR_CONST_GENERIC_NAMING, Error, "Const generic parameter '{}' must end with '_' (e.g., 'N_') to denote compile-time constant.")

// --- Parser Errors ---
DIAG(ERR_EXPECTED_SEMI,      Error, "Expected ';' or newline after statement")
DIAG(ERR_EXPECTED_DECL,      Error, "Expected declaration after 'pub' modifier")
DIAG(ERR_EXTERN_PUB,         Error, "'extern' blocks cannot be declared 'pub'")
DIAG(ERR_IMPL_PUB,           Error, "'impl' blocks cannot be declared 'pub'")
DIAG(ERR_GENERIC_PARSE,      Error, "Parse error: {}")

// --- Warnings ---
DIAG(WARN_CODEGEN_UNRESOLVED, Warning, "Unresolved member type for '{}'; defaulting to i32")

// --- System & CLI ---
DIAG(ERR_FILE_IO,            Error, "File I/O Error: {}")
DIAG(ERR_CLI_ARG,            Error, "Invalid command line argument: {}")


import std/io::println
import std/memory::assert

shape Node(
    val: i32,
    ~?next: Node
)
impl Node {
    fn unwrap(~?self: Node) -> &Node <- self {
        if ~?self is ~self {
            return &self
        }
        assert(false, "unwrap null")
        return &self
    }
}

pub fn main() -> i32 {
    unsafe {
        // User's logic + Print checks
        auto ~head = new Node(val=101, ~?next=nullptr)  
        //println("head: {}", head.val)
        //assert(head.val == 101, "check head.val")
        // Push 1
        {
            for auto i in [1,2,3,4,5] {
                auto ~next = ~head
                ~head = new Node(val=i, ~?next=~next)//初始化iter.~next 他之前是 unset 的
                println("[{}]pushed: {}", i, head.val)
            }
        }
        return 0

        /*
        auto &#iter = &head
        loop {
            println("iter: {}", iter.val)
            match iter.~?next {
                auto ~n => {
                    &#iter = &n
                }
                _ => {
                    assert(false, "check null")
                    break
                }
            }
        }
        */
    }
    return 0
}

import std/string
import std/io

fn main() -> i32 {
    auto path = String::from("test_io.txt")
    auto content = String::from("Hello File IO!\nLine 2")
    
    // Write
    auto f1 = File::open(path, String::from("w"))
    if !f1.opened {
        println("Failed to open file for writing")
        return 1
    }
    f1.write(content)
    f1.close()
    
    // Read Line by Line
    auto f2 = File::open(path, String::from("r"))
    if !f2.opened {
        println("Failed to open file for reading")
        return 1
    }
    
    println("Reading lines:")
    
    // Line 1
    auto l1 = f2.read_line()
    println("Line 1: {}", l1.c_str())
    if !l1.eq(String::from("Hello File IO!\n")) {
         println("Line 1 mismatch")
         return 1
    }

    // Line 2
    auto l2 = f2.read_line()
    println("Line 2: {}", l2.c_str())
     if !l2.eq(String::from("Line 2")) {
         println("Line 2 mismatch")
         // Note: "Line 2" might not have \n if file ended there. 
         // My write call content was "Hello File IO!\nLine 2".
         return 1
    }
    
    // EOF Check
    auto l3 = f2.read_line()
    if l3.len() != 0 {
        println("Expected EOF/Empty, got len {}", l3.len())
        return 1
    }
    
    f2.close()
    
    println("IO Line Test Passed")
    return 0
}
